네트워크는 작년에 '1%의 네트워크 원리' 라는 책을 읽고 어느 정도 감을 잡았었는데, OSI 7 계층을 필두로 꼼꼼히 알아보고자 한다.

먼저, 네트워크 계층이 도입된 배경에 대해서 알아보자.

1970년대에는 TCP/IP가 미국 국방부의 ARPANET 프로젝트를 위해 개발되어 사용되고 있었다. 1980년대에 들어서면서 네트워크 기술이 더욱 발전하고 다양한 벤더들의 네트워크 시스템이 등장하면서, 벤더 중립적인 표준 네트워크 모델의 필요성이 대두되었다.

이에 따라 1984년 국제표준화기구(ISO)에서 모든 종류의 네트워크 통신을 설명할 수 있는 개념적 프레임워크로 OSI(Open System Interconnection) 7계층 모델을 개발했다.

참고로, IT 업계에서 벤더사란 하드웨어나 소프트웨어의 브랜드에 대해서 책임을 지는 기업으로 독자적인 IT 기술력을 가져 독점적인 우위를 가지고 있는 기업을 일컫는 말이라고 한다.

예를 들어, 윈도우는 MS, 네트워크 장비는 시스코, 클라우드는 아마존 등이 존재한다.

TCP/IP는 5계층 모델을 사용하며, 이는 실제 인터넷의 기본이 되는 프로토콜 스위트이다. OSI는 7계층 모델로, 모든 네트워크 통신을 설명하기 위한 개념적 참조 모델이다.

두 모델 모두 각 계층을 명확히 분리하여 모듈화함으로써 복잡한 네트워크 통신을 단순화시켰고, 표준화된 인터페이스를 제공하였으며, 각 계층별 독립적인 유지보수가 가능하게 되었다.

### 패킷의 흐름

OSI 계층을 알기 전에, 데이터를 운반하는 작은 덩아리의 '패킷'이 움직이는 흐름에 대해서 간략하게 알아보자.

1. 맨 처음에 사용자가 URL을 입력한다.
2. URL을 웹 브라우저가 해석하여 HTTP 메시지를 만들고, Socket 라이브러리에 건네준다.
3. Socket 라이브러리는 받은 HTTP 메시지를 송신 데이터로 프로토콜 스택에 건네준다.
4. TCP는 송신 데이터를 패킷의 길이에 맞게 분할하고, TCP 헤더를 부가하여 IP에 건네준다.
5. IP는 TCP에서 받은 패킷에 IP 헤더를 부가한다. 또한, MAC 주소를 조사하여 MAC 헤더도 부가하고 나서 LAN 드라이버에 건네준다.
6. LAN 드라이버는 IP에서 송신 패킷을 받고, 이것을 LAN 어댑터에 건네주어 송신하도록 지시한다. 참고로, 드라이버와 어댑터의 차이는
7. LAN 어댑터는 이더넷이 송신 가능한 상태가 되는 것을 보고 패킷을 전기 신호로 변환한 후 트위스트 페어 케이블에 내보낸다.
8. 신호가 케이블 속을 통해 리피터 허브에 도달하고, 리피터 허브가 신호를 모든 포트로 보내면 이것이 스위칭 허브에 도달한다.
9. 스위칭 허브는 도착한 패킷의 수신자 MAC 주소의 값과 자기 속에있는 주소 테이블을 대조하여 출력할 곳의 포트를 판단하고, 포트에 패킷을 중계한다.
10. 라우터는 도착한 패킷의 수신자 IP 주소의 값과 저장된 라우팅 테이블의 내용의 대조하여 출력 포트를 판단하고, 이 포트에 패킷을 중계한다.
11. 라우터가 인터넷에 출력한 패킷에는 PPPoE 헤더와 PPP 헤더가 붙어있다.
12. ADSL 모뎀에 도착한 패킷은 ATM 셀로 분할한 후 전기 신호로 변환한다.

여기까지가 클라이언트 측 LAN의 동작흐름이다.

참고로, 운영체제와 하드웨어(LAN 어댑터) 사이의 통신을 담당하는 소프트웨어가 드라이버이고 LAN 어댑터는 실제 물리적 하드웨어(장치)이다.

![img](../img/image%20copy%203.png)

이렇게 바뀐 전기 신호는 전화선 등등을 통해서 웹 서버측의 LAN으로 들어간다.

이제, 서버측에서 패킷을 다루는 흐름에 대해서 알아보자.

1. 서버측의 LAN에는 방화벽이 있어 이것을 통해 들어온 패킷을 검사하고, 통과시킬지와 차단할지를 판단한다.
2. 웹 서버의 바로 앞에 캐시 서버를 설치하는 경우 반화벽을 통과한 패킷을 캐시 서버가 가로챈다. 사용자가 요청한 페이지가 캐시 서버에 저장되어 있으면 캐시 서버가 웹 서비를 대신해서 해당 페이지를 되돌려보낸다.
3. 캐시 서버에 페이지가 저장되어 있지 않으면 요청이 전송되어 웹 서버에 도착한다.
4. 웹 서버에 패킷이 도착하면 LAN 어댑터와 LAN 드라이버가 연대하여 패킷을 수신하고, 프로토콜 스택에 건네준다.
5. 프로토콜 스택은 IP 헤더와 TCP 헤더를 차례대로 검사하여 오류가 없으면 패킷에서 HTTP 메시지의 조각을 추출하여 원래 모습으로 되돌린다.
6. 원래 모습으로 되돌아온 HTTP 메시지는 Socket 라이브러리를 통해 웹 서버에 전달된다.
7. 웹 서버는 받은 HTTP 메시지의 내용을 해석해서 요청하는 내용에 따라 데이터를 추출하여 클라이언트에 반송한다.

![img](../img/image%20copy%204.png)

### 소켓 통신이란 ?

소켓 라이브러리와 프로포콜 스택 사이의 과정을 말한다.

- 클라이언트 측

URL로부터 생성된 HTTP 메시지가 소켓 라이브러리를 통해 프로토콜 스택으로 전달되는 부분 (과정 2-3)

- 서버 측

프로토콜 스택에서 재조립된 HTTP 메시지가 소켓 라이브러리를 통해 웹 서버로 전달되는 부분 (과정 5-6)

이제, 진짜로 TCP/IP 프로토콜 스택의 동작과정을 표준화 한 OSI 계층에 대해 알아보자.

### OSI 5 계층과 7 계층이란 ?

- OSI 7계층

물리 → 데이터링크 → 네트워크 → 전송 → 세션 → 표현 → 응용

- TCP/IP 5계층

물리 → 데이터링크 → 네트워크 → 전송 → 응용

세션계층, 표현계층, 응용계층을 하나의 응용계층으로 통합했다.

![image](../img/image%20copy.png)

### 5계층 간 동작 과정

1. 물리 계층 (physical)

```
과정 7: "LAN 어댑터는 이더넷이 송신 가능한 상태가 되는 것을 보고 패킷을 전기 신호로 변환한 후 트위스트 페어 케이블에 내보낸다"
```

- 네트워크 데이터를 전기 신호로 변환하여 전송
- 케이블, 리피터, 허브 등의 물리적 장비가 동작
- 비트(0과 1)단위의 데이터를 전송

2. 데이터 링크 계층 (datalink)

```
과정 6: "LAN 드라이버는 IP에서 송신 패킷을 받고, 이것을 LAN 어댑터에 건네주어 송신하도록 지시한다"
```

- 네트워크 기기 간의 데이터 전송과 물리 주소(MAC) 지정
- 물리 계층에서 발생할 수 있는 오류 감지 및 수정
- 프레임 단위로 데이터 전송
- 주요 프로토콜: 이더넷, MAC
- 주요 장비: 스위치, 브리지

3. 네트워크 계층 (network)

```
과정 5: "IP는 TCP에서 받은 패킷에 IP 헤더를 부가한다. 또한, MAC 주소를 조사하여 MAC 헤더도 부가하고 나서 LAN 드라이버에 건네준다"
```

- 데이터 경로 설정(라우팅)과 논리 주소(IP) 지정
- 서로 다른 네트워크 간의 통신 담당
- 패킷 단위로 데이터 전송
- 주요 프로토콜: IP, ICMP, ARP
- 주요 장비: 라우터

4. 전송 계층 (transport)

```
과정 4: "TCP는 송신 데이터를 패킷의 길이에 맞게 분할하고, TCP 헤더를 부가하여 IP에 건네준다"
```

- 종단 간 신뢰성 있는 데이터 전송 관리
- 데이터 분할과 재조립, 흐름 제어, 오류 제어
- 세그먼트 단위로 데이터 전송
- 주요 프로토콜: TCP, UDP
- 포트 번호를 통한 주소 지정

5. 응용 계층 (application)

```
과정 1: 사용자가 URL 입력
과정 2: "URL을 웹 브라우저가 해석하여 HTTP 메시지를 만들고, Socket 라이브러리에 건네준다"
과정 3: "Socket 라이브러리는 받은 HTTP 메시지를 송신 데이터로 프로토콜 스택에 건네준다"
```

- 사용자 인터페이스와 네트워크 서비스 제공
- OSI 모델의 세션, 표현, 응용 계층의 기능 포함
- 주요 프로토콜: HTTP, FTP, SMTP, DNS, SSH
- 사용자가 실제로 사용하는 응용 프로그램과 관련된 계층

---

⭐️ 이슈

네트워크 흐름을 알면 트래픽 패턴을 분석하여 네트워크 수요를 예측해서 인프라를 확장하거나 업그레이드할 시기를 결정할 수 있고, 네트워크 병목 현상이나 비효율적인 라우팅을 찾아내어 전반적인 네트워크 성능을 개선하여 사용자 경험이 향상 될 수 있다.

네트워크도 필히 알아야 하는 것 같다.
